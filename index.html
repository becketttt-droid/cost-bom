<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cost Analysis | PeSDTT630D-HW</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --bg: #050505; --card: #121212; --card-hover: #1c1c1c;
            --text: #ffffff; --subtext: #888888;
            --accent: #FF3B30; /* Red for Cost */
            --material: #5E5CE6; /* Purple for Material */
            --processing: #30D158; /* Green for Processing */
            --trend-line: #FF453A; --safe-bottom: env(safe-area-inset-bottom);
            --ios-ease: cubic-bezier(0.25, 1, 0.5, 1);
        }
        body { background-color: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; touch-action: pan-y; }
        .container { width: 100%; max-width: 600px; padding: 20px 20px 100px 20px; }
        
        /* Header */
        header { text-align: center; margin: 20px 0 30px; }
        .total-title { font-size: 13px; color: #666; letter-spacing: 2px; text-transform: uppercase; font-weight: 600; margin-bottom: 5px; }
        .total-amount-box { display: flex; align-items: baseline; justify-content: center; gap: 6px; }
        .currency-symbol { font-size: 20px; color: #666; }
        .total-main-num { font-size: 56px; font-weight: 700; color: #fff; letter-spacing: -1px; }
        .unit-tag { font-size: 20px; font-weight: 500; color: #888; }

        /* Chart Area */
        .trend-wrapper { width: 100%; height: 220px; background: #121212; border-radius: 16px; margin-bottom: 25px; position: relative; overflow: hidden; border: 1px solid #222; }
        .trend-svg { width: 100%; height: 100%; display: block; }
        .trend-line { fill: none; stroke: var(--trend-line); stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; }
        .trend-area { fill: url(#trendGradient); opacity: 0.3; }
        .chart-hud { position: absolute; top: 15px; left: 15px; }
        .hud-label { font-size: 11px; color: #666; font-weight: 600; text-transform: uppercase; }
        .hud-val { font-size: 16px; font-weight: bold; color: #fff; margin-top: 2px; }

        /* Structure Bar */
        .structure-card { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid #222; margin-bottom: 25px; }
        .chart-title { font-size: 14px; font-weight: 600; color: #888; margin-bottom: 15px; display: flex; justify-content: space-between; }
        .structure-bar { width: 100%; height: 12px; background: #222; border-radius: 6px; display: flex; overflow: hidden; margin-bottom: 15px; }
        .struct-seg { height: 100%; transition: width 1s var(--ios-ease); }
        .legend-box { display: flex; gap: 15px; font-size: 12px; color: #aaa; }
        .legend-item { display: flex; align-items: center; gap: 6px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        /* List */
        .list-title { font-size: 18px; font-weight: 700; margin: 30px 0 15px; padding-left: 10px; border-left: 3px solid var(--accent); }
        .category-group { background: var(--card); border-radius: 16px; margin-bottom: 12px; overflow: hidden; border: 1px solid #222; position: relative; transition: transform 0.2s; }
        .category-group:active { transform: scale(0.98); }
        .weight-bar { position: absolute; top: 0; left: 0; bottom: 0; opacity: 0.15; z-index: 0; transition: width 1s ease; }
        .category-header { padding: 16px; display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 1; cursor: pointer; }
        .cat-info { display: flex; align-items: center; gap: 12px; }
        .cat-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; background: rgba(255,255,255,0.05); }
        .cat-name { font-size: 15px; font-weight: 600; color: #fff; }
        .cat-sub { font-size: 11px; color: #666; margin-top: 2px; }
        .cat-val { text-align: right; }
        .cat-amount { font-size: 15px; font-weight: 700; color: #fff; display: block; }
        .cat-pct { font-size: 11px; color: #666; }
        
        .category-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; background: #080808; }
        .category-group.open .category-content { max-height: 1000px; }
        .item-row { padding: 12px 16px; border-bottom: 1px solid #1a1a1a; display: flex; justify-content: space-between; font-size: 13px; }
        .item-row:last-child { border-bottom: none; }
        .item-name { color: #ddd; }
        .item-meta { font-size: 11px; color: #555; margin-top: 2px; }
        .item-cost { font-weight: 600; color: #fff; font-family: monospace; }

        /* Nav */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); border-top: 1px solid #222; height: calc(60px + var(--safe-bottom)); display: flex; justify-content: space-around; padding-bottom: var(--safe-bottom); z-index: 100; }
        .nav-item { flex: 1; display: flex; justify-content: center; align-items: center; opacity: 0.5; transition: opacity 0.3s; }
        .nav-item.active { opacity: 1; color: var(--accent); }
        .nav-icon svg { width: 24px; height: 24px; fill: currentColor; }

        /* Page Logic */
        .page { display: none; opacity: 0; animation: fadeIn 0.4s forwards; }
        .page.active { display: block; }
        @keyframes fadeIn { to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div id="page-home" class="page active">
        <header>
            <div class="total-title">TOTAL BOM COST</div>
            <div class="total-amount-box">
                <span class="currency-symbol">NT$</span>
                <span class="total-main-num" id="displayTotal">0</span>
            </div>
            <div style="font-size:12px; color:#444; margin-top:5px;">PeSDTT630D-HW (2026.01.12)</div>
        </header>

        <div class="trend-wrapper">
            <div class="chart-hud">
                <div class="hud-label">Cumulative Cost (Top 20)</div>
                <div class="hud-val">80% of Cost</div>
            </div>
            <svg class="trend-svg" viewBox="0 0 100 50" preserveAspectRatio="none">
                <defs>
                    <linearGradient id="trendGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="#FF453A" stop-opacity="0.5"/>
                        <stop offset="100%" stop-color="#FF453A" stop-opacity="0"/>
                    </linearGradient>
                </defs>
                <path class="trend-area" d="M0,50 L0,50 L10,30 L20,20 L50,10 L100,5 L100,50 Z" />
                <path class="trend-line" d="M0,50 Q10,20 100,5" vector-effect="non-scaling-stroke" />
            </svg>
        </div>

        <div class="structure-card">
            <div class="chart-title">
                <span>Cost Structure</span>
                <span id="ratioText">71% : 29%</span>
            </div>
            <div class="structure-bar">
                <div id="barMat" class="struct-seg" style="width:0%; background:var(--material);"></div>
                <div id="barProc" class="struct-seg" style="width:0%; background:var(--processing);"></div>
            </div>
            <div class="legend-box">
                <div class="legend-item"><div class="dot" style="background:var(--material)"></div> Material (Áâ©Êñô)</div>
                <div class="legend-item"><div class="dot" style="background:var(--processing)"></div> Processing (Ë®óÂ∑•)</div>
            </div>
        </div>

        <div class="list-title">Top Suppliers Breakdown</div>
        <div id="supplierList"></div>
    </div>
</div>

<nav class="nav-bar">
    <div class="nav-item active" onclick="alert('Dashboard Mode')">
        <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg></div>
    </div>
    <div class="nav-item" onclick="alert('Analysis Mode (Coming Soon)')">
        <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg></div>
    </div>
</nav>

<script>
    // --- Data Injection ---
    const rawData = {
        total: 768901,
        material: 547261,
        processing: 221640,
        suppliers: [
            { id:'HEMA', name:'HEMA (Âæ∑Âúã)', total:159168, type:'Material', items:[ {n:'ÁÖûËªäÂô® RC260N', c:53055, q:3} ] },
            { id:'SOL', name:'ÊôüÊòå (SOLPOWER)', total:112631, type:'Processing', items:[ {n:'Âª†ÂÖßÂä†Â∑•/ÁµÑË£ù', c:112631, q:1} ] },
            { id:'MJ', name:'ÊòéÊ±ü (Renishaw)', total:61295, type:'Material', items:[ {n:'ËÆÄÈ†≠ 3m', c:12610, q:2}, {n:'Áí∞ÂûãÂ∞∫', c:11830, q:2} ] },
            { id:'CS', name:'ÂÖ®ÂãùÈãºÈêµ', total:59060, type:'Material', items:[ {n:'Á¥†Êùê S45C/FCD', c:59060, q:1} ] },
            { id:'HD', name:'Ëà™Èõª (Cables)', total:49831, type:'Material', items:[ {n:'Á∑öÊùêËàáÊé•È†≠', c:49831, q:1} ] },
            { id:'KY', name:'ÁèÇÊ•≠ (Bearing)', total:43500, type:'Material', items:[ {n:'Ëª∏Êâø HRTG 200', c:14500, q:3} ] },
            { id:'CY', name:'ÂÇ≥Ë£ï (Casting)', total:36520, type:'Material', items:[ {n:'ÊóãËª∏Ê°ÜÈ´î', c:12760, q:1}, {n:'ÂÇæËª∏Ê°ÜÈ´î', c:11880, q:1} ] },
            { id:'MG', name:'ÈéÇÂÖâ (Heat Treat)', total:31165, type:'Processing', items:[ {n:'ÁÜ±ËôïÁêÜ', c:31165, q:1} ] },
            { id:'OTH', name:'Others (ÂÖ∂‰ªñ)', total:215731, type:'Material', items:[ {n:'Ëû∫Áµ≤/Ê≤πÂ∞Å/ËÄóÊùê', c:215731, q:1} ] }
        ]
    };

    // --- Animation Logic ---
    function animateValue(obj, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }

    // --- Init ---
    window.onload = function() {
        // 1. Animate Total
        animateValue(document.getElementById('displayTotal'), 0, rawData.total, 1500);

        // 2. Set Structure Bars
        const matPct = (rawData.material / rawData.total * 100).toFixed(0);
        const procPct = (rawData.processing / rawData.total * 100).toFixed(0);
        
        setTimeout(() => {
            document.getElementById('barMat').style.width = matPct + '%';
            document.getElementById('barProc').style.width = procPct + '%';
            document.getElementById('ratioText').innerText = `${matPct}% : ${procPct}%`;
        }, 500);

        // 3. Render List with Visual Weight
        const listContainer = document.getElementById('supplierList');
        
        rawData.suppliers.forEach((sup, index) => {
            const pct = (sup.total / rawData.total * 100).toFixed(1);
            const isMat = sup.type === 'Material';
            const color = isMat ? '#5E5CE6' : '#30D158'; // Purple vs Green
            const icon = isMat ? 'üì¶' : '‚öôÔ∏è';
            const specialClass = sup.id === 'HEMA' ? 'color:#FF453A;' : ''; // Highlight HEMA
            
            const div = document.createElement('div');
            div.className = 'category-group';
            div.innerHTML = `
                <div class="weight-bar" style="background:${color}; width:0%;" id="wb-${index}"></div>
                <div class="category-header" onclick="this.parentElement.classList.toggle('open')">
                    <div class="cat-info">
                        <div class="cat-icon">${icon}</div>
                        <div>
                            <div class="cat-name" style="${specialClass}">${sup.name}</div>
                            <div class="cat-sub">${sup.items.length} Items</div>
                        </div>
                    </div>
                    <div class="cat-val">
                        <span class="cat-amount">NT$ ${Math.round(sup.total).toLocaleString()}</span>
                        <span class="cat-pct">${pct}%</span>
                    </div>
                </div>
                <div class="category-content">
                    ${sup.items.map(item => `
                        <div class="item-row">
                            <div>
                                <div class="item-name">${item.n}</div>
                                <div class="item-meta">Qty: ${item.q}</div>
                            </div>
                            <div class="item-cost">$${item.c.toLocaleString()}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            listContainer.appendChild(div);

            // Animate Weight Bar
            setTimeout(() => {
                document.getElementById(`wb-${index}`).style.width = pct + '%';
            }, 800 + (index * 100));
        });
    };
</script>

</body>
</html>
